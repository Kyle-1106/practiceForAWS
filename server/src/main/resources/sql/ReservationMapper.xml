<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.server.mapper.ReservationMapper">
    <insert id="insert" parameterType="com.example.server.entity.Reservation" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO reservations (user_id, book_id, status)
        VALUES (#{userId}, #{bookId}, #{status})
    </insert>

    <select id="findByUserId" resultType="com.example.server.entity.Reservation">
        SELECT 
            r.id,
            r.user_id as userId,
            r.book_id as bookId,
            r.status,
            r.reserved_at as reservedAt,
            r.borrowed_at as borrowedAt,
            r.returned_at as returnedAt,
            b.title as bookTitle,
            b.author as bookAuthor,
            b.cover_image as bookCoverImage
        FROM 
            reservations r
            JOIN books b ON r.book_id = b.id
        WHERE 
            r.user_id = #{userId}
            AND r.status = '予約中'
        ORDER BY 
            r.reserved_at DESC
    </select>
</mapper> 